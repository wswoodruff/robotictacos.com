var w=Object.defineProperty;var f=(a,t,i)=>t in a?w(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i;var e=(a,t,i)=>f(a,typeof t!="symbol"?t+"":t,i);import{j as u,V as r,Q as m,E as g}from"./superneatlib-Brxwjqra.js";class x{constructor({object:t,store:i,turnSpeed:s=.1,allowTurning:l=!0,allowTilt:o=!0,speed:n=.2,damping:y=.07,friction:d=1,tilt:p=Math.PI*2}){e(this,"controllerType","keyboard");e(this,"axis",new u);e(this,"inverseAxis",!1);e(this,"inverseKeys",!1);e(this,"keys",{ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1,KeyW:!1,KeyS:!1});e(this,"frameID",-1);e(this,"targetObject",null);e(this,"enabled",!1);e(this,"damping",.07);e(this,"velocity",new r);e(this,"speed",.02);e(this,"acceleration",new r);e(this,"m_acceleration",new r);e(this,"gravity",new r);e(this,"friction",0);e(this,"turnSpeed",.1);e(this,"tiltAmount",Math.PI*2);e(this,"allowTurning",!0);e(this,"allowTilt",!0);e(this,"forward",new r(0,0,-1));e(this,"direction",new r);e(this,"targetRotation",new m);e(this,"eulerR",new g);e(this,"pawnForward",new r);this.targetObject=t,this.tiltAmount=p,this.allowTurning=l,this.allowTilt=o,this.damping=y,this.speed=n,this.friction=d,this.turnSpeed=s,document.addEventListener("keydown",this.keyDownEvents.bind(this)),document.addEventListener("keyup",this.keyUpEvents.bind(this)),this.enabled=!0;const h=this;function c(){h.enabled&&(h.frameID=requestAnimationFrame(c)),h.applyForces()}c()}applyForces(){const t=this.targetObject,i=this.damping,s=this.velocity,l=this.speed;this.friction;const o=this.acceleration;o.add(this.gravity);const n=this.axis;this.keys.ArrowLeft&&(n.x=-1),this.keys.ArrowRight&&(n.x=1),this.keys.ArrowUp&&(n.y=1),this.keys.ArrowDown&&(n.y=-1),n.x*=-1,this.keys.KeyW&&(o.y+=l),this.keys.KeyS&&(o.y-=l),this.inverseAxis&&(n.x*=-1,n.y*=-1),o.x+=l*n.x,o.z+=l*n.y,s.multiplyScalar(i),s.add(o),o.set(0,0,0),t.position.add(s),this.allowTurning&&this.applyTurning(),this.allowTilt&&this.applyTilt()}applyTilt(){const t=this.tiltAmount,i=this.targetObject,s=this.velocity;s.length()>1e-6&&(i.rotation.x=-s.z*t,i.rotation.z=s.x*t,i.rotation.y=s.y*t)}applyTurning(){const t=this.velocity,i=this.targetObject;this.direction.set(t.x,0,t.z).normalize(),this.pawnForward.set(0,0,1),this.targetRotation.setFromUnitVectors(this.pawnForward,this.direction),this.turnSpeed=.1,t.length()>1e-6&&i.quaternion.slerp(this.targetRotation,this.turnSpeed)}destroy(){document.removeEventListener("keydown",this.keyDownEvents),document.removeEventListener("keydown",this.keyUpEvents),cancelRequestAnimationFrame(_this.frameID)}keyDownEvents(t){this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!0)}keyUpEvents(t){this.keys.hasOwnProperty(t.code)&&(this.keys[t.code]=!1);let i=0;for(var s=0;s<this.keys.length;s++)this.keys[s]===!0&&i++;i===0&&this.axis.set(0,0)}}export{x as D};
